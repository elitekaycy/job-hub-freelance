<!-- job-board.component.html -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-3xl font-bold text-blue-700">
          {{ mode() === 'jobSeeker' ? 'Job Seekers Board' : 'Manage Jobs' }}
        </h1>
        <p class="text-gray-600 mt-2">
          {{ mode() === 'jobSeeker' ? 'Find jobs that match your skills and preferences' : 'Manage your job postings' }}
        </p>
      </div>
      
      <div class="flex items-center">
        <p *ngIf="loading" class="text-center text-2xl mr-4 text-blue-600">Loading...</p>
        
        <!-- Post New Job Button (for job owners) -->
        <button 
          *ngIf="mode() === 'jobOwner'"
          (click)="openPostJobModal()"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
          Post New Job
        </button>
      </div>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1" for="search">Search Jobs</label>
        <input 
          id="search"
          type="text" 
          [(ngModel)]="searchTerm" 
          (ngModelChange)="onSearchTermChange($event)"
          placeholder="Job title or keyword" 
          class="form-input">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1" for="category">Category</label>
        <select 
          id="category"
          [(ngModel)]="selectedCategory" 
          (ngModelChange)="applyFilters()"
          class="form-input">
          <option value="">All Categories</option>
          <option *ngFor="let category of categories()" [value]="category.categoryId">
            {{ category.name }}
          </option>
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1" for="status">Status</label>
        <select 
          id="status"
          [(ngModel)]="selectedStatus" 
          (ngModelChange)="applyFilters()"
          class="form-input">
          <option *ngFor="let status of statusOptions()" [value]="status.value">
            {{ status.label }}
          </option>
        </select>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1" for="sort">Sort By</label>
        <select 
          id="sort"
          [(ngModel)]="selectedSort" 
          (ngModelChange)="applyFilters()"
          class="form-input">
          <option *ngFor="let option of sortOptions()" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>
    </div>
    
    <div class="flex justify-between items-center mt-6">
      <p class="text-gray-600">
        Showing {{ (currentPage - 1) * itemsPerPage + 1 }}-{{ currentPage * itemsPerPage > totalJobs ? totalJobs : currentPage * itemsPerPage  }} of {{ totalJobs }} jobs
      </p>
      <div *ngIf="mode() === 'jobSeeker' && currentUser?.jobPreferences?.length" class="text-sm text-blue-600">
        <span class="font-medium">Your preferences:</span> 
        {{ currentUser?.jobPreferences?.join(', ') }}
      </div>
    </div>
  </div>

  <!-- Job Listings -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
    <!-- Job Card -->
    <div *ngFor="let job of jobs" 
      class="job-card bg-white rounded-lg shadow p-4"
      [class.focused]="focusedJobId === job.jobId"
      (click)="openDetailsModal(job)"
      (mouseenter)="setFocus(job.jobId)"
      (mouseleave)="removeFocus()"
      tabindex="0">
      <div class="flex justify-between items-start mb-2">
        <h2 class="text-lg font-bold text-blue-700 truncate">{{ job.name }}</h2>
        <span class="status-badge shrink-0 ml-2" [ngClass]="getStatusClass(job.status)">
          {{ job.status | titlecase }}
        </span>
      </div>
      
      <p class="text-gray-600 text-sm mb-3 description-clamp">
        {{ job.description }}
      </p>
      
      <div class="grid grid-cols-1 gap-2 mb-3">
        <div class="flex items-center">
          <span class="text-gray-400 mr-2 text-sm">$</span>
          <span class="font-medium text-sm">{{ job.payAmount | number }}</span>
        </div>
        <div class="flex items-center">
          <span class="text-gray-400 mr-2 text-sm">‚è±</span>
          <span class="text-sm">By: {{ getCompletionDate(job) }}</span>
        </div>
        <div class="flex items-center">
          <span class="text-gray-400 mr-2 text-sm">üìÖ</span>
          <span class="text-sm">Exp: {{ formatDate(job.expiryDate) }}</span>
        </div>
      </div>
      
      <div class="flex justify-between items-center">
        <div class="flex items-center">
          <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-2">
            <span class="text-blue-600">{{ getCategoryIcon(job.categoryId) }}</span>
          </div>
          <div>
            <p class="text-xs font-medium">
              {{ getJobCategoryName(job.categoryId) | titlecase }}
            </p>
            <p class="text-xs text-gray-500">Posted {{ formatDate(job.createdAt) }}</p>
          </div>
        </div>
        
        <div class="flex space-x-1 flex-wrap justify-end">
          <!-- Job Seeker Actions -->
          <ng-container *ngIf="mode() === 'jobSeeker'">
            <!-- Claim button -->
            <button 
              *ngIf="canClaimJob(job)"
              (click)="$event.stopPropagation(); openClaimModal(job)"
              class="action-btn bg-blue-600 text-white hover:bg-blue-700">
              Claim
            </button>
            
            <!-- Submit button -->
            <button 
              *ngIf="canSubmitJob(job)"
              (click)="$event.stopPropagation(); openSubmitModal(job)"
              class="action-btn bg-green-600 text-white hover:bg-green-700">
              Submit
            </button>
          </ng-container>

          <!-- Job Owner Actions -->
          <ng-container *ngIf="mode() === 'jobOwner'">
            <!-- Approve button -->
            <button 
              *ngIf="canApproveOrRejectJob(job)"
              (click)="$event.stopPropagation(); openApproveModal(job)"
              class="action-btn bg-green-600 text-white hover:bg-green-700">
              Approve
            </button>
            
            <!-- Reject button -->
            <button 
              *ngIf="canApproveOrRejectJob(job)"
              (click)="$event.stopPropagation(); openRejectModal(job)"
              class="action-btn bg-red-600 text-white hover:bg-red-700">
              Reject
            </button>
            
            <!-- Edit button -->
            <button 
              *ngIf="canEditOrDeleteJob(job)"
              (click)="$event.stopPropagation(); openPostJobModal(job)"
              class="action-btn bg-blue-600 text-white hover:bg-blue-700">
              Edit
            </button>
            
            <!-- Delete button -->
            <button 
              *ngIf="canEditOrDeleteJob(job)"
              (click)="$event.stopPropagation(); openDeleteModal(job)"
              class="action-btn bg-gray-600 text-white hover:bg-gray-700">
              Delete
            </button>
          </ng-container>
        </div>
      </div>
    </div>
  </div>

  <!-- No jobs message -->
  <div *ngIf="jobs.length === 0" class="bg-white rounded-lg shadow p-8 text-center">
    <p class="text-gray-600 text-lg">No jobs found matching your criteria.</p>
    <button (click)="clearFilters()" 
            class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
      Clear Filters
    </button>
  </div>

  <!-- Pagination -->
  <div *ngIf="jobs.length > 0" class="bg-white rounded-lg shadow px-6 py-4 flex items-center justify-between">
    <div>
      <p class="text-sm text-gray-700">
        Showing <span class="font-medium">{{ (currentPage - 1) * itemsPerPage + 1 }}</span> to 
        <span class="font-medium">{{ currentPage * itemsPerPage > totalJobs ? totalJobs : currentPage * itemsPerPage }}</span> of 
        <span class="font-medium">{{ totalJobs }}</span> results
      </p>
    </div>
    <div class="flex space-x-2">
      <button 
        (click)="changePage(currentPage - 1)" 
        [disabled]="currentPage === 1"
        class="pagination-btn px-3 py-1 rounded-lg border border-gray-300 text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
        Previous
      </button>
      
      <button 
        *ngFor="let page of [].constructor(totalPages); let i = index" 
        (click)="changePage(i + 1)"
        [class.bg-blue-600]="currentPage === i + 1"
        [class.text-white]="currentPage === i + 1"
        [class.border-blue-600]="currentPage === i + 1"
        class="pagination-btn px-3 py-1 rounded-lg border border-gray-300 text-gray-600">
        {{ i + 1 }}
      </button>
      
      <button 
        (click)="changePage(currentPage + 1)" 
        [disabled]="currentPage === totalPages || !hasMore"
        class="pagination-btn px-3 py-1 rounded-lg border border-gray-300 text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed">
        Next
      </button>
    </div>
  </div>

  <!-- Claim Job Modal -->
  <div *ngIf="showClaimModal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md modal">
      <h3 class="text-xl font-bold text-blue-700 mb-4">Claim Job</h3>
      <p class="text-gray-600 mb-6">Are you sure you want to claim "{{ selectedJob?.name }}"?</p>
      
      <div class="flex justify-end space-x-3">
        <button 
          (click)="closeClaimModal()"
          class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition">
          Cancel
        </button>
        <button 
          (click)="claimJob()"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
          {{ loading ? 'Claiming...' : 'Confirm Claim'}}
        </button>
      </div>
    </div>
  </div>

  <!-- Submit Job Modal -->
  <div *ngIf="showSubmitModal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md modal">
      <h3 class="text-xl font-bold text-blue-700 mb-4">Submit Work</h3>
      <p class="text-gray-600 mb-2">Please provide details of the work you've completed for "{{ selectedJob?.name }}":</p>
      
      <textarea 
        [(ngModel)]="submissionDetails"
        rows="5"
        placeholder="Describe the work you've completed..."
        class="form-input w-full mt-3"></textarea>
      
      <div class="flex justify-end space-x-3 mt-6">
        <button 
          (click)="closeSubmitModal()"
          class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition">
          Cancel
        </button>
        <button 
          (click)="submitJob()"
          class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
          {{loading ? "Submitting..." : "Submit Work"}}
        </button>
      </div>
    </div>
  </div>

  <!-- Approve Job Modal -->
  <div *ngIf="showApproveModal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md modal">
      <h3 class="text-xl font-bold text-blue-700 mb-4">Approve Submission</h3>
      <p class="text-gray-600 mb-2">Please provide a message for approving "{{ selectedJob?.name }}":</p>
      
      <textarea 
        [(ngModel)]="approvalMessage"
        rows="3"
        placeholder="Message for approval..."
        class="form-input w-full mt-3"></textarea>
      
      <div class="flex justify-end space-x-3 mt-6">
        <button 
          (click)="closeApproveModal()"
          class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition">
          Cancel
        </button>
        <button 
          (click)="approveJob()"
          class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
          {{loading ? "Approving..." : "Approve Submission"}}
        </button>
      </div>
    </div>
  </div>

  <!-- Reject Job Modal -->
  <div *ngIf="showRejectModal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md modal">
      <h3 class="text-xl font-bold text-blue-700 mb-4">Reject Submission</h3>
      <p class="text-gray-600 mb-2">Please provide a reason for rejecting "{{ selectedJob?.name }}":</p>
      
      <textarea 
        [(ngModel)]="rejectReason"
        rows="3"
        placeholder="Reason for rejection..."
        class="form-input w-full mt-3"></textarea>
      
      <div class="flex justify-end space-x-3 mt-6">
        <button 
          (click)="closeRejectModal()"
          class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition">
          Cancel
        </button>
        <button 
          (click)="rejectJob()"
          class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
          {{loading ? "Rejecting..." : "Reject Submission"}}
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Job Modal -->
  <div *ngIf="showDeleteModal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md modal">
      <h3 class="text-xl font-bold text-red-700 mb-4">Delete Job</h3>
      <p class="text-gray-600 mb-6">
        Are you sure you want to delete "<strong>{{ selectedJob?.name }}</strong>"? 
        <br><span class="text-red-600 text-sm">This action cannot be undone.</span>
      </p>
      
      <div class="flex justify-end space-x-3">
        <button 
          (click)="closeDeleteModal()"
          class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition">
          Cancel
        </button>
        <button 
          (click)="deleteJob()"
          class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
          {{ loading ? 'Deleting...' : 'Delete Job' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Post/Edit Job Modal -->
  <div *ngIf="showPostJobModal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl modal">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-bold text-blue-700">
          {{ selectedJob ? 'Edit Job' : 'Post New Job' }}
        </h2>
        <button 
          (click)="closePostJobModal()"
          class="text-gray-500 hover:text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      
      <app-job-post 
        *ngIf="showPostJobModal"
        [job]="selectedJob"
        (saved)="onJobSaved()"
        (canceled)="closePostJobModal()">
      </app-job-post>
    </div>
  </div>

  <!-- Job Details Modal -->
  <div *ngIf="showDetailsModal" class="fixed inset-0 z-50 flex items-center justify-center modal-backdrop">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-2xl modal modal-content">
      <div class="flex justify-between items-start mb-4">
        <h2 class="text-2xl font-bold text-blue-700">{{ selectedJob?.name }}</h2>
        <button 
          (click)="closeDetailsModal()"
          class="text-gray-500 hover:text-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
          <h3 class="text-sm font-medium text-gray-500">Category</h3>
          <p class="text-lg">{{ getJobCategoryName(selectedJob?.categoryId || '') }}</p>
        </div>
        <div>
          <h3 class="text-sm font-medium text-gray-500">Status</h3>
          <span class="status-badge" [ngClass]="getStatusClass(selectedJob?.status || '')">
            {{ selectedJob?.status | titlecase }}
          </span>
        </div>
        <div>
          <h3 class="text-sm font-medium text-gray-500">Payment</h3>
          <p class="text-lg">${{ selectedJob?.payAmount | number }}</p>
        </div>
        <div>
          <h3 class="text-sm font-medium text-gray-500">Complete By</h3>
          <p class="text-lg">{{ getCompletionDate(selectedJob!) }}</p>
        </div>
        <div>
          <h3 class="text-sm font-medium text-gray-500">Expires</h3>
          <p class="text-lg">{{ formatDate(selectedJob?.expiryDate || '') }}</p>
        </div>
        <div>
          <h3 class="text-sm font-medium text-gray-500">Posted</h3>
          <p class="text-lg">{{ formatDate(selectedJob?.createdAt || '') }}</p>
        </div>
      </div>
      
      <div class="mb-6">
        <h3 class="text-sm font-medium text-gray-500">Description</h3>
        <p class="text-gray-800">{{ selectedJob?.description }}</p>
      </div>
      
      <div class="flex justify-end space-x-3">
        <!-- Job Seeker Actions -->
        <ng-container *ngIf="mode() === 'jobSeeker'">
          <button 
            *ngIf="canClaimJob(selectedJob!)"
            (click)="showDetailsModal = false; openClaimModal(selectedJob!)"
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
            Claim Job
          </button>
          <button 
            *ngIf="canSubmitJob(selectedJob!)"
            (click)="showDetailsModal = false; openSubmitModal(selectedJob!)"
            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
            Submit Work
          </button>
        </ng-container>

        <!-- Job Owner Actions -->
        <ng-container *ngIf="mode() === 'jobOwner'">
          <button 
            *ngIf="canApproveOrRejectJob(selectedJob!)"
            (click)="showDetailsModal = false; openApproveModal(selectedJob!)"
            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
            Approve
          </button>
          <button 
            *ngIf="canApproveOrRejectJob(selectedJob!)"
            (click)="showDetailsModal = false; openRejectModal(selectedJob!)"
            class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">
            Reject
          </button>
          <button 
            *ngIf="canEditOrDeleteJob(selectedJob!)"
            (click)="showDetailsModal = false; openPostJobModal(selectedJob!)"
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
            Edit
          </button>
          <button 
            *ngIf="canEditOrDeleteJob(selectedJob!)"
            (click)="showDetailsModal = false; openDeleteModal(selectedJob!)"
            class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition">
            Delete
          </button>
        </ng-container>
        
        <button 
          (click)="closeDetailsModal()"
          class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition">
          Close
        </button>
      </div>
    </div>
  </div>
</div>