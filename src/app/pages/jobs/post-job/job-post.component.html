<!-- job-post.component.html -->
<div class="job-post-container">
  <h1 class="text-2xl font-bold text-blue-700 mb-6 pb-2 text-center">
    {{ job() ? 'Edit Job' : 'Create a New Job Listing' }}
  </h1>

  <form [formGroup]="jobForm" (ngSubmit)="submitJob()" class="grid grid-cols-1 gap-3">
    <div class="w-full">
      <input formControlName="name" required class="form-input" placeholder="Job Name">
      @if (jobForm.get('name')?.hasError('required') && jobForm.get('name')?.touched) {
        <div class="text-red-500 text-xs">Job name is required</div>
      }
    </div>

    <div class="w-full">
      <textarea formControlName="description" required rows="2" class="form-input" placeholder="Job Description"></textarea>
      @if (jobForm.get('description')?.hasError('required') && jobForm.get('description')?.touched) {
        <div class="text-red-500 text-xs">Job description is required</div>
      }
    </div>

    <div class="w-full">
      <app-single-select 
        [options]="jobCategories" 
        [selectedValue]="jobForm.value.categoryId??null"
        (selected)="onCategorySelect($event)" 
        [disabled]="!!jobForm.get('categoryId')?.disabled">
      </app-single-select>
      @if (jobForm.get('categoryId')?.hasError('required') && jobForm.get('categoryId')?.touched) {
        <div class="text-red-500 text-xs">Category is required</div>
      }
    </div>

    <div class="w-full">
      <div class="text-gray-600 text-xs mb-1">Pay Amount</div>
      <div class="relative">
        <span class="absolute left-1.5 top-[38%] transform -translate-y-1/2 font-bold text-[1rem] text-gray-500">$</span>
        <input formControlName="payAmount" type="number" required class="form-input pl-8">
      </div>
      @if (jobForm.get('payAmount')?.hasError('min') && jobForm.get('payAmount')?.touched) {
        <div class="text-red-500 text-xs">Pay amount must be greater than 0</div>
      }
    </div>

    <div class="w-full">
      <div class="text-gray-600 text-xs mb-1">Time to Complete</div>
      <input 
        type="date" 
        formControlName="timeToCompleteDate" 
        required 
        class="form-input"
        [class.bg-gray-100]="!!jobForm.get('timeToCompleteDate')?.disabled"
        [class.cursor-not-allowed]="!!jobForm.get('timeToCompleteDate')?.disabled"
        [min]="today()">
      @if (jobForm.get('timeToCompleteDate')?.hasError('required') && jobForm.get('timeToCompleteDate')?.touched) {
        <div class="text-red-500 text-xs">Time to complete is required</div>
      }
    </div>

    <div class="w-full">
      <div class="text-gray-600 text-xs mb-1">Expiry Date</div>
      <input 
        type="date" 
        formControlName="expiryDate" 
        required 
        class="form-input"
        [class.bg-gray-100]="!!jobForm.get('expiryDate')?.disabled"
        [class.cursor-not-allowed]="!!jobForm.get('expiryDate')?.disabled"
        [min]="today()">
      @if (jobForm.get('expiryDate')?.hasError('required') && jobForm.get('expiryDate')?.touched) {
        <div class="text-red-500 text-xs">Expiry date is required</div>
      }
    </div>

    <div class="w-full flex space-x-3">
      <button 
        type="button"
        (click)="cancel()"
        class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition w-1/2">
        Cancel
      </button>
      <button 
        type="submit" 
        [disabled]="loading || jobForm.invalid" 
        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition w-1/2 disabled:opacity-50">
        {{ loading ? (job() ? 'Updating...' : 'Posting...') : (job() ? 'Update Job' : 'Post Job') }}
      </button>
    </div>
  </form>
</div>